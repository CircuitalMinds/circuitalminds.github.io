<html lang="en">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>    
    <div id="test"></div>
</body>
<script>

var defaults = {
    width: 2**9, height: 2**9,
    style: {
        "display": "inline-block"
    }
};

function update_data ( canvas_obj, data ) {
    function set_data( k, v ) {
        if ( typeof(v) == 'object' ) {                        
            Object.keys(v).map( n => canvas_obj[k][n] = v[n] );
        } else {
            canvas_obj[k] = v;
        };        
    };
    Object.keys(data).map( k => set_data(k, data[k]) );
    return canvas_obj;
};

function init_canvas ( id, settings={} ) {
    obj = $('#' + id)[0];
    settings = ( Object.keys(settings).length == 0 ) ? defaults : settings;    
    obj.innerHTML = '<canvas></canvas>';
    canvas_obj = update_data(obj.querySelector('canvas'), settings);
    return canvas_obj;
};

var context_object = {
    "2d": ( obj ) => ( obj.getContext('2d') )
};
var gradient_object = {
    "conic": ( ctx, [angle, x, y] ) => ( ctx.createConicGradient(angle, x, y) )
};
function gradient_color ( type, obj, data ) {    
    gradient = gradient_object[type]( obj, [0, 100, 100] );
    Object.keys(data).map(
        k => gradient.addColorStop(data[k], k)
    );
    obj.fillStyle = gradient;
    obj.fillRect(20, 20, 200, 200);
};


function Animation ( func, frames, timer=2 ) {
    i = 0;
    var interval = setInterval( function () {
        for ( var i = 0; i < frames; i++ ) {
          func(i);
        };        
    }, timer * 1000 );   
};

function dot_product ( u, v ) {
  	Tx = 0;    
  	u.map( ui => Tx += ui * v[u.indexOf(ui)] );  	
    return Tx;
};

function vector_unit ( u ) {
    wn = Math.sqrt(dot_product(u, u));
    return u.map( ui => ui / wn );

}

function color_map ( vector ) {
    v_unit =  vector_unit(vector);
    return v_unit.map(
        vi => Math.floor(Math.abs(vi) * 255)
    );
};

var LorenzAttractor = {
    model: function (t, [x, y, z], [a, b, c]=[0.75, 17.5, 1.95] ) {
        return [a * ( x - y ), b * x - x * z - y, - y, x * y - c * z];
    },
    animate: function ( obj_id, f=this.model ) {                              
        Canvas = init_canvas(obj_id);
        ctx = context_object['2d']( Canvas );
        dt = 0.5*10**-2;
        [px, py] = [defaults.width * 0.5, defaults.height * 0.5];
        scale = 35;
        steps = 10**4; 
        t = 0;
        data = [[2.8, 0.8, 0.5]];
        while ( t < steps && data[t].indexOf(Infinity) == -1 ) {
            u = data[t]            
            ft = f(t, u);
            data.push([u[0] + dt * ft[0], u[1] + dt * ft[1], u[2] + dt * ft[2]]);
            t += 1;
        };
        function draw_step ( i ) {                        
            u = data[i];            
            v = data[i + 1];            
            p = v.map( e => Math.abs(e) );
            ctx.strokeStyle = 'rgb(' + color_map(v).join(',') + ')';
            ctx.beginPath();
            ctx.moveTo(px + u[0] * scale, py + u[1] * scale);
            ctx.lineTo(px + v[0] * scale, py + v[1] * scale);
            ctx.stroke();            
        };        
        frames = data.length - 1;  
        i = 0;
        var interval = setInterval( function () {
            if ( i < frames ) {
                draw_step(i);
                i += 1;
            } else {
                i = 0;
                ctx.clearRect(0, 0, Canvas.width, Canvas.height);                
            };
        }, 1);
    }
};


function OdeInt ( f, initial_condition, time, dt=0.01, frames=10 ) {
    tn = [ time[0] ];
    yn = [ initial_condition ];    
    function Yt ( ti, yi ) {    
        ti += dt;
        Ft = f(ti, yi).map( fi => dt * fi );
        Xt = [ ti, yi.map( x => x + Ft[yi.indexOf(x)] ) ];        
        return Xt;    
    };
    i = 0;
    xt = [tn[0], yn[0]];
    while ( xt[0] < time[1] ) {
        xt = Yt(xt[0], xt[1]);
		if ( i % frames == 0 ) {
        	tn.push(xt[0]);
            yn.push(xt[1]);     
        };
        i += 1;
    };
    return [tn, yn];
};

LorenzAttractor.animate("test");
</script>
</html>