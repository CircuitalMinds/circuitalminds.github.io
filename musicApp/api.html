<video class="light fg-cyan" id="play-media" data-aspect-ratio="hd"
       data-role="video-player" data-loop-icon="<span class='mif-loop2 fg-cyan'></span>"
   	   data-mute-icon="<span class='mif-volume-mute2 fg-cyan'></span>"
	   data-volume-low-icon="<span class='mif-volume-low fg-cyan'></span>"
	   data-volume-medium-icon="<span class='mif-volume-medium fg-cyan'></span>"
	   data-volume-high-icon="<span class='mif-volume-high fg-cyan'></span>"
	   data-play-icon="<img src='./static/images/play-icon.png'>"
	   data-stop-icon="<img src='./static/images/player_stop.png'>" data-src=""
	   data-volume="1" data-on-end="endSong('up');">
</video>
<script src="./get_music_app.js"></script>
<script>
var playList;
var idsPlayList = {};
var currentId;
var currentSong = document.getElementById('play-song');
var playMedia = document.getElementById('play-media');
var searchList = document.getElementById("search-list");    
var fb_share = document.getElementsByClassName("cell fb-share-button")[0];   
var url_previews = "https://circuitalminds.github.io/previews/music/";

let requestURL = 'https://raw.githubusercontent.com/CircuitalMinds/circuitalminds.github.io/main/musicApp/music_data_list.json';
let requestData = new XMLHttpRequest();
requestData.open('GET', requestURL);
requestData.responseType = 'json';
requestData.send();

function getIds( data ) {
	for (var i=0; i < data.length; i++) {
idsPlayList[data[i]['video_title']] = i
	};
};

requestData.onload = function() {
    const jsonData = requestData.response;
    playList = jsonData['music_data_list'];
    getIds(playList);
    if (share_data != -1) {
        currentId = idsPlayList[decodeURI(url_data.split("=")[1])]
    } else {    
        currentId = Math.round(Math.random() * (playList.length - 1));
    }                
    fb_share.dataset.href = url_previews + encodeURI(playList[currentId]['video_title']);
    playMedia.setAttribute("src", playList[currentId]['video_url']);
    currentSong.innerHTML = playList[currentId]['video_title'];
};
</script>
